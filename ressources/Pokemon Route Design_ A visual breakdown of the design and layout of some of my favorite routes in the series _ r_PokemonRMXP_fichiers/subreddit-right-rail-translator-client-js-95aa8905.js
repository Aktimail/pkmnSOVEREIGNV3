import{t,_ as e,n as a,g as n,aT as s,bE as r,bF as i,bG as o,bH as l,e as d}from"./shell-a9dcd804.js";import{x as h}from"./icon-d7ad820f.js";import{B as c}from"./base-translator-465d1d0d.js";let u=class extends c{constructor(){super(...arguments),this.partialRequestController=new s(this),this.isFetchingTranslations=!1,this.isHeaderLoaded=!1}get targetElement(){if(this.target){const t=document.querySelector(this.target);if(t)return t}return this}async connectedCallback(){super.connectedCallback();const t=!!this.targetElement.querySelector("shreddit-subreddit-header")?.shadowRoot;t?(this.isHeaderLoaded=t,this.translationContextValue?.isTranslationActive&&this.onTranslationsEnabled()):this.targetElement.addEventListener(r,this.onHeaderReady)}async disconnectedCallback(){super.disconnectedCallback(),this.targetElement.removeEventListener(r,this.onHeaderReady)}async onHeaderReady(t){"shreddit-subreddit-header"===t.detail?.name&&(this.isHeaderLoaded=!0,this.translationContextValue?.isTranslationActive&&this.onTranslationsEnabled())}async onTranslationsEnabled(){if(!this.isHeaderLoaded)return;if(this.translationCache)return this.renderCachedStrings("translated");if(this.isFetchingTranslations)return;const t=[...this.getTranslatableHeaderElements(),...this.getTranslatableWidgetElements()],e=t.map((t=>t.innerHTML));this.isFetchingTranslations=!0;const a=await this.fetchStringsTranslation(e);this.isFetchingTranslations=!1,this.translationCache=t.map(((t,n)=>({element:t,originalText:e[n],translatedText:a[n]}))).filter((({translatedText:t})=>!!t)),this.translationContextValue?.isTranslationActive&&this.renderCachedStrings("translated")}onTranslationsDisabled(){this.renderCachedStrings("original")}getTranslatableHeaderElements(){const t=[],e=this.targetElement.querySelector("shreddit-subreddit-header")?.shadowRoot,a=e?.querySelector(".i18n-subreddit-title"),n=e?.querySelector(".i18n-subreddit-description");return a?.textContent&&t.push(a),n?.textContent&&t.push(n),t}getTranslatableWidgetElements(){const t=[],e=this.targetElement.querySelectorAll(".i18n-translatable-text");return Array.from(e).forEach((e=>{e.textContent&&t.push(e)})),t}async fetchStringsTranslation(t){const e=new FormData;t.forEach((t=>e.append("strings[]",t)));const a=await this.partialRequestController.request("/svc/shreddit/translated-strings",{method:i.Post,body:e}),n=await(a?.text());if(!(!!n&&!1===n.includes?.(o)))return[];const s=n?l(n):null;return Array.from(s||[]).map((t=>{const e=document.createElement("textarea");return e.innerHTML=t.innerHTML,e.textContent??""}))}renderCachedStrings(t){this.translationCache&&this.translationCache?.forEach((e=>{const a="translated"===t?e.translatedText:e.originalText;"string"==typeof a&&a.length>=1&&(e.element.innerHTML=a)}))}render(){return h`<div><slot></slot></div>`}};u.styles=[t],e([a({type:String})],u.prototype,"target",void 0),e([n()],u.prototype,"isFetchingTranslations",void 0),e([n()],u.prototype,"isHeaderLoaded",void 0),u=e([d("subreddit-right-rail-translator")],u);
