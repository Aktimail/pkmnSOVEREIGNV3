import{a as t,c as e,G as a,s as i,u as s,t as n,_ as o,I as l,g as r,e as c,n as h,aB as d,aC as p,l as u,L as m,aD as v,ap as k,K as b,O as g,w as f,eG as C,eH as x,eI as T}from"./shell-a9dcd804.js";import{S as w}from"./index-b42a465d.js";import{x as y,c as A,I as S,a as E,s as M,bw as D,bx as I,bh as $,A as V}from"./icon-d7ad820f.js";import{l as F,L as O}from"./expandable-section-header-a5b37930.js";import{a as B,T as L}from"./faceplate-textarea-input-9ac7fafc.js";import{j,k as R,l as z,T as N,m as G,n as _}from"./translations-2dea4523.js";import{t as U,c as P,d as q,e as Q,f as Y,g as K,h as W}from"./translation-53e7c06c.js";import"./app-selector-client-js-197aee07.js";import"./select-controller-b7a961d7.js";import"./community-picker-75beb711.js";import"./faceplate-tooltip-c6801851.js";import"./helpers-8837cd77.js";import"./constants-775ffd1d.js";import"./filterNullish-9ec33a16.js";import"./text-input-1e857ee0.js";import"./links-30dbf643.js";import"./age-gate-standalone-client-js-55e13342.js";import"./TinyGesture-89d9957c.js";import"./user-flair-aefa9eac.js";var X;!function(t){t.GREAT="great",t.NOT_GREAT="not great"}(X||(X={}));let H=class extends(t(M)){constructor(){super(...arguments),this.otherReasonFormValue="",this.isOpen=!1,this.handleDismiss=()=>{this.trackEvent(j()),this.close()}}show(){this.trackEvent(R()),this.faceplateDialog?.showModal?.(),this.isOpen=!0}close(){this.faceplateDialog?.close?.(),this.isOpen=!1,this.selectedOption=void 0,this.otherReasonFormValue=""}showThankYouAlert(){this.dispatchEvent(e("faceplate-alert",{level:a.success,message:"Merci pour l’évaluation"}))}handleUpvoteTranslation(){this.selectedOption=X.GREAT}handleDownvoteTranslation(){this.selectedOption=X.NOT_GREAT}handleSubmit(){this.selectedOption&&(this.trackEvent(z({reason:this.selectedOption,survey_text:this.otherReasonFormValue})),this.showThankYouAlert(),this.close())}render(){return y` <faceplate-dialog id="global-translation-feedback-faceplate-dialog" class="translation-feedback"> <div class="flex flex-col gap-lg"> <div class="flex justify-between"> <h3 class="font-bold text-24 text-neutral-content-strong m-0" data-testid="modal-title"> Ces traductions te plaisent\u00A0? </h3> ${i({attributes:{onclick:this.handleDismiss},appearance:"secondary",leadingIcon:A({size:S.Medium}),size:s.Medium})} </div> <p class="m-0" data-testid="modal-subtitle"> Fais-nous savoir ce que tu penses de la traduction de Reddit. </p> <div class="flex justify-center gap-md"> <button data-testid="upvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===X.GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleUpvoteTranslation}" @keydown="${this.handleUpvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Smile_EyesOpen.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> Super </p> </button> <button data-testid="downvote-translation" class="py-md px-lg cursor-pointer border-none rounded-md ${this.selectedOption===X.NOT_GREAT?"bg-neutral-background-selected":"bg-neutral-background-medium"}" @click="${this.handleDownvoteTranslation}" @keydown="${this.handleDownvoteTranslation}"> <img src="${CLIENT_CONFIG.STATIC_BASE_URL}assets/snoomojis/Snoo_Expression_Blanc.png" class="block m-auto pb-xs" width="56" height="56" alt=""> <p class="font-semibold text-14 text-center text-neutral-content-strong m-0"> Pas terrible </p> </button> </div> ${this.selectedOption?y` <div class="flex w-full box-border"> <faceplate-textarea-input data-testid="other-reason-input" maxlength="500" appearance="${B.BORDERED}" size="${L.EXPANDED}" @keyup="${t=>{t.stopPropagation(),this.otherReasonFormValue=t.target.value}}" class="w-full" .value="${this.otherReasonFormValue}"> <span slot="label">Laisser un commentaire (facultatif)</span> </faceplate-textarea-input> </div> `:y``} <div class="flex justify-end"> ${i({appearance:"primary",size:s.Large,shape:"pill",attributes:{onclick:this.handleSubmit,className:"flex box-border","data-testid":"submit-feedback-button",disabled:!this.selectedOption},children:y`<span class="font-semibold text-14">Donne ton avis</span>`})} </div> </div> </faceplate-dialog> `}};H.styles=[E`.translation-feedback{border-radius:16px;max-width:400px;padding:2rem 1.5rem 1.5rem 1.5rem;width:82%}`,n],o([l("#global-translation-feedback-faceplate-dialog")],H.prototype,"faceplateDialog",void 0),o([r()],H.prototype,"selectedOption",void 0),o([r()],H.prototype,"otherReasonFormValue",void 0),o([r()],H.prototype,"isOpen",void 0),H=o([c("global-translation-feedback-modal")],H);const J="reddit-cookie-banner",Z="faceplate-bottom-sheet#xpromo-bottom-sheet",tt="faceplate-modal#blocking-modal",et=t(M);function at(t){return!!t?.open}let it=class extends et{constructor(){super(...arguments),this.isDesktop=!1,this.withFeedback=!1,this.translationContextValue=p,this.withCoachmark=!1,this.withTranslationSettings=!1,this.hasCoachmarkDisplayLimit=!1,this.translationActiveMsg="Traductions activées",this.handleTranslationActiveSwitch=()=>{const t=!this.translationContextValue.isTranslationActive;this.dispatchContextUpdateEvent({isTranslationActive:t})},this.closeTranslationCoachmark=()=>{this.translationCoachmark?.close?.(),this.onCoachmarkClose()},this.openTranslationCoachmark=()=>{this.trackEvent(U(!!this.translationContextValue.isTranslationActive)),this.translationCoachmark?.show?.()},this.openTranslationMenu=()=>{this.trackEvent(P(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.show?.():this.translationMenuBottomSheet?.showModal?.()},this.closeTranslationMenu=()=>{this.trackEvent(P(!!this.translationContextValue.isTranslationActive)),this.isDesktop?this.translationDropdownMenu?.close?.():this.translationMenuBottomSheet?.close?.()},this.openFeedbackModal=()=>{this.translationFeedbackModal?.show?.()},this.handleCoachmarkSettingsClick=()=>{this.closeTranslationCoachmark(),this.openTranslationMenu(),this.trackEvent(q(Q.UpdateSettings))},this.handleTranslationActiveClick=t=>{t.stopPropagation(),this.trackEvent(Y(!!this.translationContextValue.isTranslationActive))},this.handleTooltipClick=t=>{t.stopPropagation()},this.handleCoachmarkCloseClick=()=>{this.closeTranslationCoachmark(),this.trackEvent(q(Q.Dismiss))},this.handleNavMobileButtonClick=()=>{this.openTranslationMenu(),this.trackEvent(K(!!this.translationContextValue.isTranslationActive))},this.handleNavbarButtonClick=()=>{this.trackEvent(K(!!this.translationContextValue.isTranslationActive)),this.trackEvent(P(!!this.translationContextValue.isTranslationActive))},this.handleGiveFeedbackButtonClick=()=>{this.openFeedbackModal(),this.closeTranslationMenu()},this.onCoachmarkClose=()=>{setTimeout((()=>{this.dispatchContextUpdateEvent({shouldDisplayCoachmark:!1,shouldDisplayFeedbackCoachmark:!0})}),500)}}connectedCallback(){super.connectedCallback();"mtseo-disabled"===u.getItem(m.I18nTranslationInterventionShown)&&(setTimeout((()=>{this.dispatchEvent(e("faceplate-alert",{level:a.success,message:"Les traductions sont désactivées."}))}),1e3),u.setItem(m.I18nTranslationInterventionShown,"true"))}updated(t){this.withCoachmark&&!this.hasCoachmarkDisplayLimit&&t.has("translationContextValue")&&void 0!==this.translationContextValue.isTranslationActive&&this.displayCoachmark()}displayCoachmark(){const{coachmarkDisplayCount:t,shouldDisplayCoachmark:e}=this.translationContextValue;window.setTimeout((()=>{if(!e)return;if(this.hasCoachmarkObstacles())return;const a=t<1;this.dispatchContextUpdateEvent({coachmarkDisplayCount:t+1,shouldDisplayCoachmark:a,shouldDisplayFeedbackCoachmark:!a}),a&&this.openTranslationCoachmark(),this.hasCoachmarkDisplayLimit=!0}),1500)}hasCoachmarkObstacles(){const t=!!document.querySelector(J),e=function(t){const e=document.querySelector(t);return e?k(at,e):[]}(Z),a=!!document.querySelector(tt);return t||e?.length>0||a}dispatchContextUpdateEvent(t){const e={...this.translationContextValue,...t},a=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:e});this.dispatchEvent(a)}renderCoachmark(){return this.translationContextValue.shouldDisplayCoachmark?y`<div class="flex flex-col"> <div class="flex flex-row flex-nowrap items-start"> <div class="flex-shrink flex-grow-0 pt-xs pl-xs mr-xs"> ${D({size:S.Small})} </div> <div class="flex flex-col flex-grow flex-shrink-0 pt-xs items-start"> <h3 class="mt-0 text-14">${this.translationActiveMsg}</h3> <p class="mt-0 max-w-[10rem] xs:max-w-none"> ${this.translationContextValue.isTranslationActive?"Les publications et commentaires sont traduits automatiquement":"Traduire automatiquement les publications et les commentaires"} </p> </div> <div class="flex-shrink flex-grow-0"> ${i({size:s.Medium,appearance:"plainInverted",shape:"pill",leadingIcon:A({size:S.Small}),attributes:{"aria-label":"Fermer",id:"coachmark-close-button",onclick:this.handleCoachmarkCloseClick}})} </div> </div> <div class="flex flex-nowrap gap-xs justify-end"> ${i({children:"Paramètres",size:s.Medium,appearance:"plainInverted",shape:"pill",attributes:{id:"coachmark-settings-button",onclick:this.handleCoachmarkSettingsClick}})} </div> </div>`:y``}renderDesktopMenu(){return y`<faceplate-dropdown-menu position="bottom-end" id="translation-desktop-menu"> ${i({size:s.Medium,appearance:"plain",shape:"pill",leadingIcon:I({size:S.Medium}),attributes:{id:"translation-menu-button","aria-label":this.translationActiveMsg,onclick:this.handleNavbarButtonClick}})} <faceplate-menu slot="menu" dropdown hidden> ${F({label:y` <faceplate-switch-input id="hui-translation-switch" appearance="${w.PRIMARY}" class="inline-flex flex-row-reverse gap-sm" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="-ml-xs">${this.translationActiveMsg}</span> </faceplate-switch-input> `,size:O.Medium})} ${this.withTranslationSettings?F({label:y` <span class="flex flex-row items-center"> ${$({size:S.Medium})} <span class="ml-xs"> Param\u00E8tres de traduction </span> </span> `,attributes:{id:"translation-settings-list-item"},size:O.Medium,href:"/settings/preferences"}):V} ${this.withFeedback?F({label:"Donner un avis sur la traduction",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:O.Medium,onClick:this.handleGiveFeedbackButtonClick}):V} </faceplate-menu> </faceplate-dropdown-menu>`}renderMobileMenu(){return y`<div> ${i({size:s.Medium,appearance:"plain",shape:"pill",leadingIcon:I({size:S.Medium}),attributes:{id:"translation-menu-button",onclick:this.handleNavMobileButtonClick,"aria-label":this.translationActiveMsg}})} <faceplate-bottom-sheet id="translation-mobile-menu"> <div class="p-md flex flex-col items-stretch w-full gap-md"> <faceplate-switch-input id="hui-translation-switch" appearance="${w.PRIMARY}" class="flex flex-row-reverse justify-between gap-sm px-xs" ?checked="${this.translationContextValue.isTranslationActive}" @input="${this.handleTranslationActiveSwitch}" @click="${this.handleTranslationActiveClick}"> <span class="inline-flex items-center gap-xs"> ${I({size:S.Medium})} <span> ${this.translationActiveMsg} </span> </span> </faceplate-switch-input> ${this.withFeedback?F({label:"Donner un avis sur la traduction",attributes:{"data-testid":"hui-translation-button-feedback-option"},size:O.Medium,onClick:this.handleGiveFeedbackButtonClick}):V} </div> </faceplate-bottom-sheet> </div>`}render(){return y` <faceplate-tooltip position="${this.isDesktop?"bottom-end":"bottom"}" appearance="inverted" id="translation-coachmark-tooltip" trigger-event="none" @click="${this.handleTooltipClick}"> <div slot="trigger"> ${this.isDesktop?this.renderDesktopMenu():this.renderMobileMenu()} </div> ${this.renderCoachmark()} </faceplate-tooltip> ${this.withFeedback?y` <global-translation-feedback-modal id="hui-translation-button-feedback-modal"></global-translation-feedback-modal>`:V} `}};it.styles=[n],o([h({type:Boolean,attribute:"is-desktop"})],it.prototype,"isDesktop",void 0),o([h({type:Boolean,attribute:"with-feedback"})],it.prototype,"withFeedback",void 0),o([d({context:v,subscribe:!0}),r()],it.prototype,"translationContextValue",void 0),o([h({type:Boolean,attribute:"with-coachmark"})],it.prototype,"withCoachmark",void 0),o([h({type:Boolean,attribute:"with-translation-settings"})],it.prototype,"withTranslationSettings",void 0),o([r()],it.prototype,"hasCoachmarkDisplayLimit",void 0),o([l("#translation-coachmark-tooltip")],it.prototype,"translationCoachmark",void 0),o([l("#translation-desktop-menu")],it.prototype,"translationDropdownMenu",void 0),o([l("#translation-mobile-menu")],it.prototype,"translationMenuBottomSheet",void 0),o([l("#hui-translation-button-feedback-modal")],it.prototype,"translationFeedbackModal",void 0),it=o([c("hui-translation-button")],it);let st=class extends(t(M)){constructor(){super(...arguments),this.translationContextValue=p,this.isNewAccountAge=!1,this.isRegularSEOVisit=!1,this.isMTSEOVisit=!1,this.isNewImmersiveVisit=!1,this.withBackendSetting=!1,this.newPreferredLanguages=[],this.requestClientGQL=b}connectedCallback(){super.connectedCallback(),this.isSettingInitialized()?this.syncTranslationSettingsWithCookie():this.initializeTranslationSettings(),this.newPreferredLanguages.length>0&&this.initializePreferredLanguageSettings()}initializePreferredLanguageSettings(){this.requestClientGQL({operation:g.UpdatePreferredLanguagesPreference,variables:{input:{languages:this.newPreferredLanguages}}})}updated(t){if(!t.has("translationContextValue")||!this.withBackendSetting)return;const e=t.get("translationContextValue"),a=this.translationContextValue.isTranslationActive,i=e?.isTranslationActive;if(void 0===i)return;(!0!==i&&!0===a||!1!==i&&!1===a)&&this.saveTranslationSettingInAccount(a)}async initializeTranslationSettings(){const t=this.fetchTranslationSettingFromCookie(),e=await this.fetchTranslationSettingFromGQL();let a,i={...this.translationContextValue};if(t&&(i={...i,...t}),null!==e&&e!==t?.isTranslationActive&&(i={...i,isTranslationActive:e},a=N.BACKEND),null===t&&null===e){const[t,e]=this.getFallbackIsTranslationActive();a=e,i={...i,isTranslationActive:t}}this.dispatchContextUpdateEvent(i),null===e&&void 0!==i.isTranslationActive&&this.saveTranslationSettingInAccount(i.isTranslationActive),a&&(i.isTranslationActive?this.trackEvent(G(a)):this.trackEvent(_(a))),sessionStorage.setItem(m.TranslationInitialized,Date.now().toString()),this.trackEvent(W(!!i.isTranslationActive))}getFallbackIsTranslationActive(){return this.isNewImmersiveVisit?this.isNewAccountAge?[!0,N.ACCOUNT_AGE]:[!1,N.DEFAULT_OFF]:this.isMTSEOVisit?[!1,N.MT_SEO]:this.isRegularSEOVisit?[!1,N.REGULAR_SEO]:this.isNewAccountAge?[!0,N.ACCOUNT_AGE]:[!1,N.DEFAULT_OFF]}syncTranslationSettingsWithCookie(){const t=this.fetchTranslationSettingFromCookie();let e={...this.translationContextValue};t&&t.isTranslationActive!==e.isTranslationActive&&(e={...e,...t},this.dispatchContextUpdateEvent(e)),this.trackEvent(W(!!e.isTranslationActive))}fetchTranslationSettingFromCookie(){const t=f.get(C)??"";return x(t)}async fetchTranslationSettingFromGQL(){if(!this.withBackendSetting)return null;try{const{data:t}=await this.requestClientGQL({operation:g.IdentityImmersiveTranslationSetting}),e=t.identity?.preferences?.isMachineTranslationImmersive;return null==e||e===T.Unset?null:e===T.Enabled}catch{}return null}async saveTranslationSettingInAccount(t){if(!this.withBackendSetting)return null;try{await this.requestClientGQL({operation:g.UpdateAccountPreferences,variables:{input:{isMachineTranslationImmersive:t?T.Enabled:T.Disabled}}})}catch{}return null}dispatchContextUpdateEvent(t){const e=new CustomEvent("update-translation-context",{bubbles:!0,composed:!0,detail:t});this.dispatchEvent(e)}isSettingInitialized(){const t=sessionStorage.getItem(m.TranslationInitialized);return!!(t&&Date.now()-parseInt(t,10)<36e5)}render(){return y`<div> <slot></slot> </div>`}};o([d({context:v,subscribe:!0}),r()],st.prototype,"translationContextValue",void 0),o([h({type:Boolean,attribute:"is-new-account-age"})],st.prototype,"isNewAccountAge",void 0),o([h({type:Boolean,attribute:"is-regular-seo-visit"})],st.prototype,"isRegularSEOVisit",void 0),o([h({type:Boolean,attribute:"is-mt-seo-visit"})],st.prototype,"isMTSEOVisit",void 0),o([h({type:Boolean,attribute:"is-new-immersive-visit"})],st.prototype,"isNewImmersiveVisit",void 0),o([h({type:Boolean,attribute:"with-backend-setting"})],st.prototype,"withBackendSetting",void 0),o([h({type:Array,attribute:"new-preferred-languages"})],st.prototype,"newPreferredLanguages",void 0),st=o([c("translation-settings-admin")],st);
