import"./open-interstitial-modal-79545e5b.js";import"./confirm-over-18-4e42c188.js";import{a as t,s as e,x as i,aU as s,aP as o,I as n}from"./icon-d7ad820f.js";import"./chat-mobile-xpromo-client-js-342f9966.js";import"./reddit-page-data-464e8844.js";import"./category-takeover-ad-client-js-1da9f098.js";import{t as r,_ as l,n as a,g as d,c,dF as p,dG as h,s as m,u,e as f}from"./shell-a9dcd804.js";import"./shreddit-tweet-embed-ab2f1ce0.js";import"./faceplate-tabgroup-5a1193bd.js";import"./faceplate-tabpanel-65c8a7fd.js";import"./article-details-feed-client-js-d6722a9f.js";import"./comment-body-header-1e0d5db3.js";import"./protected-community-modal-trigger-d992d6e7.js";import"./select-controller-b7a961d7.js";import"./community-picker-75beb711.js";import"./author-flair-event-handler-26a7555d.js";import"./qr-code-modal-upsell-client-js-25088b6d.js";import"./guard-community-modal-88767739.js";import"./chat-channel-recommendations-client-js-4b93fcaf.js";import"./hui-user-drawer-client-js-9e94c0bf.js";import{g}from"./password-recovery-d61e525b.js";import"./age-gate-standalone-client-js-55e13342.js";import"./with-ad-observer-972950e0.js";import"./errors-8d0111b7.js";import"./overflow-menu-actions-ec094350.js";import"./distinguished-tags-4752ad65.js";import"./activate-lead-gen-dialog-5b2b39d4.js";import"./shreddit-dynamic-ad-link-77e5b3bd.js";import"./click-location-tracker-3430eb18.js";import"./community-club-highlights-client-js-2b06d5e7.js";import"./TinyGesture-89d9957c.js";import"./subreddit-posting-eligibility-c0987c5f.js";import"./gallery-fe8fc2ba.js";import"./links-30dbf643.js";import"./faceplate-tablist-35552fbd.js";import"./faceplate-textarea-input-9ac7fafc.js";import"./text-input-1e857ee0.js";import"./filterNullish-9ec33a16.js";import"./constants-775ffd1d.js";import"./user-flair-aefa9eac.js";import"./validate-image-9f48337a.js";import"./faceplate-form-f63ed129.js";const b="-comment-rtjson-content",j="#text",T=t=>t.replace(/\n/g,"").replace(/\s+/g," ").trim(),x=({commentId:t,noPrefix:e})=>{let i=t.replace(b,"");return e&&(i=i.replace("t1_","")),i},C=({commentId:t,permalink:e,snippetData:i})=>t?`https://publish.reddit.com/embed?url=https://www.reddit.com${e.replace(/\/[^/]+(?=\/$)|\/$/,"")}comment/${x({commentId:t,noPrefix:!0})}?snippet=${i}`:`https://publish.reddit.com/embed?url=https://www.reddit.com${e}?snippet=${i}`,v=["TR","TH","TD","TABLE","TBODY","THEAD"],y=new Set(["H1","P"]);let S=class extends e{constructor(){super(...arguments),this.postId="",this.permalink="",this.topOffset=0,this.leftOffset=0,this.snippetData="",this.isTitleSelected=!1,this.isSelectionOutOfRange=!1,this.isFullTextSelected=!1,this.isComment=!1,this.clearSelection=t=>{if(2!==t.button&&t.target.getAttribute("postid")!==this.postId){const e=((t,e)=>{for(;t;){if(t.id&&(t.id.includes(`${e}-post-rtjson-content`)||t.id.includes(b)))return t;t=t.parentNode}return null})(t.target,this.postId);this.richTextContainer=e,getSelection()?.empty(),this.snippetData="",this.isTitleSelected=!1,this.isSelectionOutOfRange=!1,this.isFullTextSelected=!1}},this.handleEmbedClick=()=>{this.isComment&&this.richTextContainer?.id?open(C({commentId:this.richTextContainer?.id,permalink:this.permalink,snippetData:this.snippetData}),"RedditEmbed"):open(C({permalink:this.permalink,snippetData:this.snippetData}),"RedditEmbed"),this.sendClickTelemetry()},this.isTripleClickHandled=t=>3===t.detail,this.getChildTextNode=t=>{let e;const i=t.childNodes;for(let t=0;t<i.length;t++){const s=i[t];if(s.nodeName!==j)continue;0!==T(s.textContent||"").length&&(e=s)}return e},this.getCorrectSelection=t=>{const e=getSelection();if(this.isTripleClickHandled(t)&&e?.anchorNode?.nodeName&&y.has(e?.anchorNode?.nodeName)){const t=this.getChildTextNode(e.anchorNode),i=t?.textContent?.length||0;e.setBaseAndExtent(t,0,t,i)}return e},this.calculateSnippetData=t=>{if(this.shouldShowButton)return void this.clearSelection(t);this.isComment=Boolean(this.richTextContainer?.id&&this.richTextContainer.id.startsWith("t1")),this.snippetData="";const e=this.getCorrectSelection(t),i=T(e?.toString()||"");if(!e||!i?.length)return;const s=this.richTextContainer?T(this.richTextContainer.innerText):"",o=T(this.postTitleElement.innerText);this.richTextContainer&&i===s&&(this.isFullTextSelected=!0);const n=e?.anchorNode;if(n.parentNode?.nodeName&&v.includes(n.parentNode?.nodeName))return;const r=e.getRangeAt(0);n.parentNode===this.postTitleElement&&(this.isTitleSelected=!0),(this.isTitleSelected&&i.length>o.length||this.richTextContainer&&i.length>s.length)&&(this.isSelectionOutOfRange=!0);const l=this.isTitleSelected?this.postTitleElement?.getBoundingClientRect():this.richTextContainer?.getBoundingClientRect(),a=e?.getRangeAt(0).getBoundingClientRect();if(l&&a){if(this.topOffset=a.top+scrollY,this.leftOffset=a.left+a.width/2,(this.shadowRoot?.host).style.setProperty("--left-offset",`${this.leftOffset}px`),(this.shadowRoot?.host).style.setProperty("--top-offset",this.topOffset-32-4+"px"),this.isTitleSelected||this.isFullTextSelected)return void this.sendViewTelemetry();if(e.rangeCount>0){let t=-1;const e=Array.from((this.isComment?this.richTextContainer?.children[0].children:this.richTextContainer?.children)||[]).filter((t=>t.nodeName!==j));for(let i=0;i<e.length;i++){const s=e[i];if(r.intersectsNode(s)){t=i;break}}if(-1!==t&&i){const s=(({nodeText:t,selectedText:e})=>{if(!t||!e)return-1;const i=t.length,s=e.length,o=[];for(let t=0;t<=i;t++)o[t]=new Array(s+1).fill(0);let n=0,r=0;for(let l=1;l<=i;l++)for(let i=1;i<=s;i++)t[l-1]===e[i-1]&&(o[l][i]=o[l-1][i-1]+1,o[l][i]>n&&(n=o[l][i],r=l-1));const l=t.substring(r-n+1,r+1);return l?t.indexOf(l):-1})({nodeText:T(e[t].innerText),selectedText:i});t>-1&&s>-1&&i.length>0&&(this.snippetData=`${t}_${s}_${i.length}`,this.sendViewTelemetry())}}}},this.getEventDetails=()=>{const t={};return this.isComment&&this.richTextContainer?.id&&(t.comment={id:x({commentId:this.richTextContainer.id})}),t},this.sendViewTelemetry=()=>{const t=this.getEventDetails();this.dispatchEvent(c(p,{details:t}))},this.sendClickTelemetry=()=>{const t=this.getEventDetails();this.dispatchEvent(c(h,{details:t}))}}get shouldShowButton(){return(this.snippetData.length||this.isTitleSelected||this.isFullTextSelected)&&!this.isSelectionOutOfRange}connectedCallback(){super.connectedCallback();const t=document.getElementById(`post-title-${this.postId}`);t&&(this.postTitleElement=t),document.addEventListener("mousedown",this.clearSelection),document.addEventListener("mouseup",this.calculateSnippetData)}disconnectedCallback(){super.disconnectedCallback(),document.removeEventListener("mousedown",this.clearSelection),document.removeEventListener("mouseup",this.calculateSnippetData)}render(){return i` ${this.shouldShowButton?i` <div class="button-container bg-neutral-content-strong rounded-full shadow-sm flex"> ${m({appearance:"plainInverted",size:u.Small,attributes:{onclick:this.handleEmbedClick},leadingIcon:s(),children:"Int√©grer"})} </div> `:""} `}};S.styles=[t`.button-container{position:absolute;left:var(--left-offset);top:var(--top-offset);transform:translateX(-50%);z-index:1}`,r],l([a({type:String})],S.prototype,"postId",void 0),l([a({type:String})],S.prototype,"permalink",void 0),l([d()],S.prototype,"topOffset",void 0),l([d()],S.prototype,"leftOffset",void 0),l([d()],S.prototype,"snippetData",void 0),l([d()],S.prototype,"isTitleSelected",void 0),l([d()],S.prototype,"isSelectionOutOfRange",void 0),l([d()],S.prototype,"isFullTextSelected",void 0),l([d()],S.prototype,"isComment",void 0),S=l([f("embed-snippet-share-button")],S);let w=class extends e{constructor(){super(...arguments),this.replaceItselfWithChildren=()=>{this.replaceWith(...this.childNodes)}}render(){return i`<div class="mx-md xs:mx-0"> <div class="items-center justify-between flex flex-row py-sm px-md w-100 bg-neutral-background border-neutral-border rounded-2 border-solid border box-border"> <div> ${o({size:n.Medium,attributes:{className:"align-middle mr-2xs"}})} <span class="text-neutral-content-weak"> Publi\u00E9 depuis un compte bloqu\u00E9 </span> </div> ${m({appearance:"secondary",size:u.Small,attributes:{rel:"nofollow",id:"primary-button",onclick:this.replaceItselfWithChildren},children:"Voir la publication"})} </div> </div>`}};w.styles=[r],w=l([f("shreddit-blocked-post-content")],w),import("./faceplate-hovercard-25d58131.js").then((function(t){return t.f})),import("./faceplate-progress-433a18f1.js"),import("./faceplate-tooltip-c6801851.js"),"enabled"===window.CLIENT_EXPERIMENTS?.shreddit_pdp_no_mod_js_lo?g()&&import("./mod-notes-opener-c5b2ea82.js"):import("./mod-notes-opener-c5b2ea82.js");
