import"./faceplate-tooltip-c6801851.js";import{N as e,T as t,t as s,_ as o,n,e as i,a as r,P as a,s as d,u as c,b as p,G as l,K as u,O as m,a6 as h,c as b}from"./shell-a9dcd804.js";import{C as g}from"./comment-4f28f421.js";import{R as v}from"./distinguished-tags-4752ad65.js";import{P as y}from"./overflow-menu-actions-ec094350.js";import{o as z,x as S,a as I,s as k,aj as R,I as U,aF as f,l as C}from"./icon-d7ad820f.js";import{l as w}from"./expandable-section-header-a5b37930.js";import{i as j}from"./links-30dbf643.js";import"./select-controller-b7a961d7.js";import"./community-picker-75beb711.js";import"./mod-dropdown-closer-8bae422a.js";import"./user-flair-aefa9eac.js";import"./age-gate-standalone-client-js-55e13342.js";let P=class extends(e(k)){constructor(){super(...arguments),this.status=v.Reported,this.handlePostUpdate=({postId:e,action:t,value:s})=>{e===this.thingId&&t===y.ignoreReports&&(this.status=s?v.Ignored:v.Dismissed)},this.handleCommentUpdate=({commentId:e,action:t,value:s})=>{e===this.thingId&&t===g.ignoreReports&&(this.status=s?v.Ignored:v.Dismissed)}}connectedCallback(){super.connectedCallback(),this.subscribe(t.PostUpdated,this.handlePostUpdate),this.subscribe(t.CommentUpdated,this.handleCommentUpdate)}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribe(t.PostUpdated,this.handlePostUpdate),this.unsubscribe(t.CommentUpdated,this.handleCommentUpdate)}getStyle(){return z({"--list-icon-color":this.status===v.Reported?"var(--shreddit-color-mods-reported-onBackground)":"var(--color-secondary-onBackground)"})}render(){return this.status===v.Reported?S`<div class="bg-mods-reported-background hover:bg-mods-reported-background-hover" style="${this.getStyle()}"> <slot></slot> </div>`:S`<details class="max-w-fit bg-secondary-background hover:bg-secondary-background-hover" style="${this.getStyle()}"> <summary class="cursor-pointer block list-none" @click="${e=>e.stopPropagation()}"> <slot name="${this.status}"></slot> </summary> <slot></slot> </details>`}};P.styles=[I`summary::-webkit-details-marker{display:none}`,s],o([n({type:String,attribute:"thing-id"})],P.prototype,"thingId",void 0),o([n({type:String})],P.prototype,"status",void 0),P=o([i("reports-summary-wrapper")],P);const x=r(k);let $=class extends x{constructor(){super(...arguments),this.contentId="",this.isSnoozed=!1,this.reportReason="",this.pubsub=new a(this),this.onPostUpdateAction=e=>{if(e.postId!==this.contentId)return;const{action:t}=e;switch(t){case y.snoozeReporter:this.isSnoozed=!0;break;case y.unsnoozeReporter:this.isSnoozed=!1}},this.onCommentUpdateAction=e=>{if(e.commentId!==this.contentId)return;const{action:t}=e;switch(t){case g.snoozeReporter:this.isSnoozed=!0;break;case g.unsnoozeReporter:this.isSnoozed=!1}}}connectedCallback(){super.connectedCallback(),j(this.contentId)?this.pubsub.subscribe(t.PostUpdated,this.onPostUpdateAction):this.pubsub.subscribe(t.CommentUpdated,this.onCommentUpdateAction)}disconnectedCallback(){super.disconnectedCallback(),j(this.contentId)?this.pubsub.unsubscribe(t.PostUpdated,this.onPostUpdateAction):this.pubsub.unsubscribe(t.CommentUpdated,this.onCommentUpdateAction)}renderReportOverflowMenu(){return S` <mod-dropdown-closer> <faceplate-dropdown-menu @click="${e=>e.stopPropagation()}" position="bottom-end"> ${d({appearance:"plain",size:c.ExtraSmall,children:R({size:U.ExtraSmall})})} <faceplate-menu slot="menu"> ${w({label:this.isSnoozed?"Ne plus ignorer les signalements de cette personne":"Ignorer les signalements de cette personne",description:this.isSnoozed?"Recevoir de nouveau les signalements de ce membre":"Suspendre les signalements de ce membre pendant 7 jours",leadingIcon:f({size:U.Small}),onClick:this.toggleSnooze})} </faceplate-menu> </faceplate-dropdown-menu> </mod-dropdown-closer> `}sendTrackingEvent(e,t,s){const o=s?"snoozereports":"unsnoozereports",n=j(e)?"post":"comment",i=j(e)?e:null,r=j(e)?null:e,a=p({source:"moderator",action:o,noun:n},{...i&&{post:{id:i}},...r&&{comment:{id:r}},...t&&{action_info:{reason:t}}});this.trackEvent(a)}showToast({success:e,isSnoozed:t}){const s=e?t?"Les signalements de ces membres seront suspendus":"Les signalements de ces membres vont reprendre":"Échec de la mise à jour des signalements",o=e?l.info:l.error,n=b("faceplate-alert",{level:o,message:s});this.dispatchEvent(n)}async updateReportState(e){try{const{data:t}=await u({operation:m.UpdateReportState,variables:{input:{itemId:this.contentId,reportText:this.reportReason,isSnoozed:e}}});return t?.updateReport?.ok??!1}catch(e){return!1}}async toggleSnooze(e){const s=!this.isSnoozed;this.sendTrackingEvent(this.contentId,this.reportReason,s);const o=await this.updateReportState(s);o&&(s?j(this.contentId)?this.pubsub.publish(t.PostUpdated,{postId:this.contentId,action:y.snoozeReporter,value:!0}):this.pubsub.publish(t.CommentUpdated,{commentId:this.contentId,action:g.snoozeReporter,value:!0}):j(this.contentId)?this.pubsub.publish(t.PostUpdated,{postId:this.contentId,action:y.unsnoozeReporter,value:!0}):this.pubsub.publish(t.CommentUpdated,{commentId:this.contentId,action:g.unsnoozeReporter,value:!0})),this.showToast({success:o,isSnoozed:this.isSnoozed})}render(){const e={"flex items-center m-0 p-0":!0,"bg-secondary-background":this.isSnoozed};return S`<li class="${h(e)}"> <slot name="${C(this.isSnoozed?"snoozed":void 0)}" class="flex-auto block"></slot> ${this.renderReportOverflowMenu()} </li> `}};$.styles=[s],o([n({type:String,attribute:"content-id"})],$.prototype,"contentId",void 0),o([n({type:Boolean,attribute:"is-snoozed"})],$.prototype,"isSnoozed",void 0),o([n({type:String,attribute:"report-reason"})],$.prototype,"reportReason",void 0),$=o([i("user-report-summary")],$);
