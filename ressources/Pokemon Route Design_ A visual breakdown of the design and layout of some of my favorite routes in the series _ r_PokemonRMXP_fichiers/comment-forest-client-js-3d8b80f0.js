import{a as e,_ as t,n as i,e as s,p as n,T as r,t as o,J as a,W as l,N as c,bH as h,s as d,u as m,P as p,I as u,ad as b,g,bV as y,S as C,c as v,G as f,a6 as S,ff as k,aJ as x,fg as w,aj as I,a_ as T,b as A,H as P,fh as $,aB as E,aC as j,fi as D,aD as B}from"./shell-a9dcd804.js";import{s as O,x as F,O as q,I as L,a as M,A as V,V as _,a8 as R,bx as U,bR as N}from"./icon-d7ad820f.js";import{k as z}from"./links-30dbf643.js";import{c as W}from"./comment-client-js-da2a7314.js";import{Q as H,bq as Q}from"./age-gate-standalone-client-js-55e13342.js";import{C as J}from"./cbau-81b2f8bd.js";import"./shreddit-spoiler-608eaa70.js";import"./mod-queue-pdp-client-js-d0bd3291.js";import"./author-flair-event-handler-26a7555d.js";import"./shreddit-comment-badges-d7bd42b3.js";import{P as K}from"./postFlair-9d6c2791.js";import{R as G}from"./pdp-comment-search-close-b31aaa37.js";import{s as X,S as Y}from"./search-params-e13e0c5a.js";import{S as Z,a as ee,b as te}from"./search-dynamic-id-e5090dbf.js";import"./reddit-feed-ecb39f7e.js";import"./faceplate-search-input-28db656a.js";import"./faceplate-tooltip-c6801851.js";import"./adjust-search-query-link-6a168f82.js";import"./suggested-search-queries-client-js-e0844c90.js";import"./translation-contribution-toggle-72264ea3.js";import"./profile-related-keywords-client-js-c2534185.js";import"./qr-code-modal-upsell-client-js-25088b6d.js";import"./hui-user-drawer-client-js-9e94c0bf.js";import"./rpl-filter-chip-b7c8979c.js";import"./ad-reminder-button-2101877e.js";import{g as ie}from"./password-recovery-d61e525b.js";import"./shop-gallery-data-fetcher-client-js-cd71f78d.js";import"./index-e9ae10a6.js";import"./comment-link-post-client-js-7fc51f68.js";import"./award-controller-25d0c262.js";import"./awardsTelemetryState-70c8634d.js";import"./distinguished-tags-4752ad65.js";import"./comment-4f28f421.js";import"./text-input-1e857ee0.js";import"./filterNullish-9ec33a16.js";import"./constants-775ffd1d.js";import"./validate-image-9f48337a.js";import"./user-flair-aefa9eac.js";import"./translations-2dea4523.js";import"./index-b42a465d.js";import"./helpers-8837cd77.js";import"./select-controller-b7a961d7.js";import"./community-picker-75beb711.js";import"./expandable-section-header-a5b37930.js";import"./TinyGesture-89d9957c.js";import"./overflow-menu-actions-ec094350.js";const se=e(O);let ne=window.location,re=class extends se{constructor(){super(...arguments),this.commentId="",this.parentCommentPermalink="",this.postPermalink="",this.isInModQueue=!1,this.onLinkClick=(e,t)=>{this.isInModQueue&&(e.stopPropagation(),e.preventDefault(),n?.(r.ModQueuePdpLinkClick,{isFullDiscussionLink:t,parentCommentPermalink:this.parentCommentPermalink,postPermalink:this.postPermalink}))}}static get styles(){return[o,a(".single-comment-thread-toolbar {\n  align-items: center;\n  display: flex;\n  flex-flow: row nowrap;\n  font: var(--font-title-h6);\n  justify-content: space-between;\n  padding: 0.5rem 1rem;\n}\n")]}firstUpdated(){this.updateComplete.then((()=>{if(this.isInModQueue)return;if("1"===new URLSearchParams(ne.search).get("draft"))return;const e=this.getBoundingClientRect().top;window.scrollTo({top:e-48,behavior:"auto"})}))}handleSeeFullDiscussionLink(e){this.onLinkClick(e,!0);const t=document.querySelector("shreddit-post");t&&this.trackEvent(z(t))}render(){if(!this.commentId)return;const e=this.isInModQueue?"Afficher le commentaire parent":"Fil de commentaires unique",t="no-underline hover:no-underline visited:no-underline text-primary";return F` <div> <div class="single-comment-thread-toolbar text-neutral-content-weak"> ${this.parentCommentPermalink?F` <a href="${this.parentCommentPermalink}" class="${t}" @click="${this.onLinkClick}"> ${e} </a> `:F` <span>${e}</span> `} <span class="flex-1 h-px mx-xs bg-tone-4" data-id="line"></span> <a href="${this.postPermalink}" class="${t}" @click="${this.handleSeeFullDiscussionLink}"> Voir la discussion enti\u00E8re </a> </div> </div> `}};t([i({type:String,attribute:"comment-id"})],re.prototype,"commentId",void 0),t([i({type:String,attribute:"parent-comment-permalink"})],re.prototype,"parentCommentPermalink",void 0),t([i({type:String,attribute:"post-permalink"})],re.prototype,"postPermalink",void 0),t([i({type:Boolean,attribute:"is-in-modqueue"})],re.prototype,"isInModQueue",void 0),re=t([s("shreddit-comments-page-tools")],re);const oe=l(O);let ae=class extends oe{constructor(){super(...arguments),this.isVisible=!1}connectedCallback(){super.connectedCallback(),this.enableObserver({threshold:1})}disconnectedCallback(){super.disconnectedCallback(),this.disableObserver()}publishEvent(){n(r.TriggerCommentBlockingAuth,{source:J.Scroll})}publishCloseEvent(){n(r.TriggerCommentBlockingAuth,{source:J.Close})}observerIsIntersectingCallback(){this.publishEvent(),this.isVisible=!0}observerIsNotIntersectingCallback(e){const{boundingClientRect:t,rootBounds:i}=e;i&&this.isVisible&&t.top>i.bottom&&(this.isVisible=!1,this.publishCloseEvent())}render(){return F`<div></div> `}};ae=t([s("cbau-trigger")],ae);const le=e(c(O));let ce=class extends le{constructor(){super(...arguments),this.postId="",this.isTruncated=!1,this.ui="mobile",this._visibilityDetails=null,this.depthUpdated=null,this.handleCommentCreated=({parentThingId:e,body:t})=>{this.postId===e&&t&&this.querySelector("#next-comment")?.after(...h(t))}}static get styles(){return[o,a(":host {\n  display: block;\n  background-color: var(--shreddit-content-background);\n  padding-bottom: var(--spacer-xs);\n}\n")]}get visibilityDetails(){return null===this._visibilityDetails&&null===this.depthUpdated&&(this.depthUpdated=new Promise((e=>{requestAnimationFrame((()=>{const t=this.getVisibilityDetails();this._visibilityDetails=t,e(t)}))}))),this._visibilityDetails}getVisibilityDetails({containerWidth:e}={}){const t=this.querySelector(":scope > shreddit-comment"),i=t?.depth??0;e??(e=this.getBoundingClientRect().width);const s="mobile"===this.ui?232:320,n="mobile"===this.ui?18:32,r="mobile"===this.ui?4:10,o=Math.floor((e-s)/n),a=Math.max(1,Math.min(o,r)),l=a+i,c=this.querySelector(":scope shreddit-comment[is-chosen-mq-comment]"),h=c?.depth??0,d=Math.max(i,h-a+1);return c?{maxVisibleDepth:d+a,minVisibleDepth:d}:{maxVisibleDepth:l}}connectedCallback(){W(this.shadowRoot),super.connectedCallback(),this.subscribe(r.CommentCreated,this.handleCommentCreated),this.resizeObserver=new ResizeObserver(H((e=>{let t=0;for(const i of e){const e=i.contentBoxSize.at(0)?.inlineSize;if(e){t=e;break}}if(0===t)return;const i=this.getVisibilityDetails({containerWidth:t});if(this._visibilityDetails?.maxVisibleDepth!==i.maxVisibleDepth||this._visibilityDetails?.minVisibleDepth!==i.minVisibleDepth){this._visibilityDetails=i,this.depthUpdated=Promise.resolve(i);for(const e of this.querySelectorAll("shreddit-comment"))e.setVisibility(i.maxVisibleDepth,i.minVisibleDepth)}}),128,!0)),this.resizeObserver.observe(this,{box:"content-box"})}disconnectedCallback(){super.disconnectedCallback(),this.unsubscribe(r.CommentCreated,this.handleCommentCreated),this.resizeObserver?.unobserve(this),this.resizeObserver?.disconnect()}showAllComments(){this.publish(r.TriggerCommentBlockingAuth,{source:J.Button}),this.isTruncated=!1,this.trackEvent(Q())}renderShredtopViewMoreCommentsButton(e){return d({attributes:{type:"button",className:"ml-sm xs:ml-0 font-semibold mt-md",onclick:e},appearance:"brand",shape:"pill",leadingIcon:q({size:L.Medium}),size:m.Small,children:"Afficher plus de commentaires"})}renderTruncatedExpandButton(){return this.renderShredtopViewMoreCommentsButton(this.showAllComments)}renderContent(){return function(e,t){const i="Section des commentaires";return e` <section class="flex flex-col px-md xs:px-0 gap-md relative" aria-label="Commentaires"> <h1 class="absolute -top-full -left-full w-px h-px overflow-hidden" aria-label="${i}"> ${i} </h1> <slot></slot> ${t?"":e`<slot name="truncated"></slot>`} </section> `}(F,this.isTruncated)}renderExpandButton(){return this.isTruncated?this.renderTruncatedExpandButton():""}render(){return F` ${this.renderContent()} ${this.renderExpandButton()} `}};t([i({type:String,attribute:"post-id"})],ce.prototype,"postId",void 0),t([i({type:Boolean})],ce.prototype,"isTruncated",void 0),t([i({type:String,attribute:"ui"})],ce.prototype,"ui",void 0),ce=t([s("shreddit-comment-tree")],ce);let he=class extends O{constructor(){super(),this.postId="",this.handleCommentCreated=({postId:e})=>{e===this.postId&&this.remove()},this.pubsub=new p(this)}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(r.CommentCreated,this.handleCommentCreated)}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(r.CommentCreated,this.handleCommentCreated)}render(){return F`<slot></slot>`}};he.styles=[M`:host{display:contents}`,o],t([i({type:String,attribute:"post-id"})],he.prototype,"postId",void 0),he=t([s("comment-forest-empty-state")],he);let de=class extends O{constructor(){super(),this.target="",this.path="",this.isMobile=!1,this.isEntityFilterEnabled=!1,this.hiddenChips=[],this.isSearchActive=!1,this.amaCommentTab=null,this.commentSearch=null,this.commentSort=null,this.pubsub=new p(this),this.replaceComments=async({sort:e="",filter:t="",entityFilterId:i=""})=>{e!==this.getCurrentSort()&&this.updateLocation({sort:e});const s=new URL(`${location.origin}${this.path}`);e&&s.searchParams.set(K.Sort,e.toLowerCase()),t&&s.searchParams.set(K.Filter,t.toLowerCase()),i&&s.searchParams.set(K.EntityFilterId,i),s.searchParams.set(K.InlineRefresh,"true");const n=s.toString().substring(location.origin.length);this.replaceContentController.loadAndReplaceContent({src:n,target:this.target,afterSuccess:()=>y(this,{message:"Les commentaires ont bien été triés",options:{priority:C.assertive}}),afterFailure:()=>this.dispatchEvent(v("faceplate-alert",{level:f.error,cause:"uncategorized",message:"Échec du chargement des commentaires."}))})},this.handleCommentFilterUpdated=({sort:e,filter:t,entityFilterId:i})=>{this.replaceComments({entityFilterId:i,filter:t??this.getCurrentFilter(),sort:e??this.getCurrentSort()})},this.handleSortEvent=async e=>{this.replaceComments({sort:e.detail.selected?.toLowerCase(),filter:this.getCurrentFilter()}),this.pubsub.publish(r.CommentSort,{sort:e.detail.selected});const t=this.querySelector("rpl-filter-chip[selected]"),i=this.allChip?.assignedElements()?.[0];t?.removeAttribute("selected"),i?.setAttribute("selected","")},this.handleAmaTabClick=e=>{const t=e.target?.closest("button")?.getAttribute("value");t&&(this.replaceComments({filter:t,sort:this.getCurrentSort()}),e.preventDefault())},this.replaceContentController=new G,this.handleCommentSearchToggle=e=>{const t=e.detail.isHidden;this.isSearchActive=t;const i=this.querySelector("search-dynamic-id-cache-controller");i?.classList.toggle("min-w-full",t)},this.handleSelect=e=>{if(e instanceof KeyboardEvent&&"Enter"!==e.key)return;let t=e.target?.closest("rpl-filter-chip");if(!t)return;const i=this.querySelector("rpl-filter-chip[selected]");i===t&&(t=this.allChip.assignedElements()[0]),i?.removeAttribute("selected"),t?.setAttribute("selected",""),this.handleCommentFilterUpdated({entityFilterId:t?.dataset.entityId,sort:"confidence"});const s=this.querySelector("shreddit-sort-dropdown");s?.silentlySelectItemByValue("CONFIDENCE")}}updateLocation({sort:e}){const t=new URL(location.href);t.searchParams.set(K.Sort,e.toLowerCase()),history.replaceState({},"",t.toString())}getCurrentFilter(){return this.querySelector("[faceplate-tab-selected]")?.getAttribute("value")?.toLowerCase()||""}getCurrentSort(){return new URLSearchParams(location.search).get(K.Sort)||""}connectedCallback(){super.connectedCallback(),this.commentSearch=this.querySelector('[slot="comment-search"]'),this.amaCommentTab=this.querySelector('[slot="ama-comment-tab"]'),this.commentSort=this.querySelector('[slot="comment-sort"]')}getNextBatchCount(){return 0===this.hiddenChips.length?10:Math.min(this.hiddenChips.filter(Boolean).length,10)}handleShowAllClick(){const e=this.getNextBatchCount(),t=this.hiddenChips.findIndex(Boolean)+e;this.hiddenChips=this.hiddenChips.map(((e,i)=>i>t))}renderDivider(){return this.isEntityFilterEnabled&&!this.isSearchActive?F`<hr class="border-neutral-border-weak my-0 mx-2xs p-0 h-xl border-[0.5px]">`:V}renderEntityFilterSlots(){const e=this.querySelectorAll('[slot^="entity-"]');if(!this.isEntityFilterEnabled||this.isSearchActive||0===e.length)return V;const t=this.getNextBatchCount(),i=0===t||this.isMobile,s=F` <slot name="all" @click="${this.handleSelect}" @keydown="${this.handleSelect}" class="chip all-chip flex flex-shrink-0"></slot> ${Array.from({length:e.length}).map(((e,t)=>{const i=!this.isMobile&&this.hiddenChips[t];return F` <slot name="entity-${t}" @click="${this.handleSelect}" @keydown="${this.handleSelect}" class="chip entity flex flex-shrink-0 ${i?"hidden":""}"></slot> `}))} ${d({appearance:"bordered",size:m.Small,children:`${t} autres`,attributes:{className:"chip show-all-chip flex "+(i?"hidden":""),onclick:this.handleShowAllClick,type:"button"}})}`;return this.isMobile?F` <div class="flex gap-xs w-full overflow-x-auto hide-scrollbar">${s}</div>`:s}firstUpdated(e){super.firstUpdated(e),requestAnimationFrame((()=>{this.measureAndHideOverflow()}))}getSpaceTakenByElement(e){const t=e?.clientWidth??0;return t+(t>0?8:0)}measureAndHideOverflow(){if(!this.container)return;const e=Array.from(this.entities);if(0===e.length)return;this.hiddenChips=e.map((()=>!1));const t=this.getSpaceTakenByElement(this.stickyContainer)+this.getSpaceTakenByElement(this.allChip)+(this.showAllChip?.clientWidth??0),i=this.container.clientWidth-t;let s=0;const n=[...this.hiddenChips];let r=!1;for(let t=0;t<e.length;t++){const o=e[t],a=this.getSpaceTakenByElement(o);s+a>i&&(r=!0),n[t]=r,s+=a}this.hiddenChips=n}renderSortbar(){const e=S({flex:!0,"xs:ml-auto":!!this.amaCommentTab,hidden:this.isSearchActive});return this.commentSort?F`<slot name="comment-sort" class="${e}"></slot>`:V}renderSearchToggle(){return this.commentSearch?F`<slot name="comment-search"></slot>`:V}renderAMATab(){const e=S({flex:!0,hidden:this.isSearchActive});return this.amaCommentTab?F` <slot name="ama-comment-tab" @click="${this.handleAmaTabClick}" @keydown="${this.handleAmaTabClick}" class="${e}"></slot> `:V}renderToolbar(){const e=S({"toolbar-container relative bg-neutral-background flex gap-xs items-center":!0,"flex-wrap":!this.isEntityFilterEnabled,"flex-1":this.isSearchActive});return F` ${this.renderAMATab()} <div class="${e}"> ${this.renderSortbar()} ${this.renderSearchToggle()} ${this.renderDivider()} </div> `}renderDesktop(e){return F` <div class="${e}"> ${this.renderToolbar()} ${this.renderEntityFilterSlots()} </div> `}renderMobile(e){return F` <div class="${e}">${this.renderToolbar()}</div> ${this.renderEntityFilterSlots()} `}render(){const e=S({"flex gap-xs outer-container items-center flex-wrap ":!0,"w-full":!this.isMobile||this.isSearchActive,"justify-between w-full":Boolean(this.amaCommentTab)});return F` <div class="flex gap-xs w-full" @comment-sort="${this.handleSortEvent}" @pdp-comment-search-toggle="${this.handleCommentSearchToggle}"> ${this.isMobile?this.renderMobile(e):this.renderDesktop(e)} </div> `}};de.styles=[o,M`.hide-scrollbar{-ms-overflow-style:none;scrollbar-width:none}`],t([i({type:String})],de.prototype,"target",void 0),t([i({type:String})],de.prototype,"path",void 0),t([i({type:Boolean,attribute:"is-mobile"})],de.prototype,"isMobile",void 0),t([u(".outer-container")],de.prototype,"container",void 0),t([u(".all-chip")],de.prototype,"allChip",void 0),t([u(".show-all-chip")],de.prototype,"showAllChip",void 0),t([b(".entity")],de.prototype,"entities",void 0),t([u(".toolbar-container")],de.prototype,"stickyContainer",void 0),t([i({type:Boolean,attribute:"entity-filter-enabled"})],de.prototype,"isEntityFilterEnabled",void 0),t([g()],de.prototype,"hiddenChips",void 0),t([g()],de.prototype,"isSearchActive",void 0),de=t([s("shreddit-comments-sort-dropdown")],de);const me="expand-pdp-comment-search-button";let pe=class extends O{constructor(){super(...arguments),this.target="",this.path="",this.showOnLoad=!1,this.initialValue="",this.isEntityFilterEnabled=!1,this.open=this.showOnLoad,this.commentSearchActive=this.showOnLoad,this.focusSearchInput=()=>{this.open||(this.open=!0),this.searchInput?.innerInput?.focus()},this.resetSearchInput=()=>{this.handleClear(),this.open=!1,Z.update(k.PdpCommentSearch),this.commentSearchActive=!1,this.expandSearchButton?.focus()},this.replaceContentController=new G,this.handlePdpCommentSearch=x((async()=>{const e=this.searchInput?.value??"";if(e){this.commentSearchActive=!0;const t={conversationId:ee.get(k.PdpCommentSearch),cursor:{},impressionId:Z.getUUID(),pane:w.Comments,query:e,scope:{type:I.PDP,path:this.path}};this.addSearchParamsToUrl(t);const i=new URLSearchParams({...X(t)});T(this,A({source:"search",action:"click",noun:"full_search_button"},this.searchTelemetryData));const s=document.createElement("span");s.id=this.target,this.replaceContentController.loadAndReplaceContent({src:`/svc/shreddit${this.path}pdp-comment-search-results?${i.toString()}`,target:this.target,wrapPartialElement:e=>(s.appendChild(e),s)})}}),300),this.handleKeyDown=e=>{Z.update(k.PdpCommentSearch),"Enter"===e.key&&e.target===this.searchInput&&this.handlePdpCommentSearch(),"Escape"===e.key&&e.target===this.searchInput&&(e.stopPropagation(),this.commentSearchActive?this.searchInput?.blur():this.resetSearchInput())},this.handleClear=()=>{this.searchInput?.value&&(this.searchInput.value="")},this.searchCommentText=()=>"Rechercher des commentaires"}hideElementsVisibility(e){this.dispatchEvent(v("pdp-comment-search-toggle",{isHidden:e}))}connectedCallback(){super.connectedCallback(),this.commentSearchActive=this.showOnLoad,this.open=this.showOnLoad}get searchTelemetryData(){const e=this.searchInput?.value??"";return{action_info:{page_type:P.PostDetail},search:{conversation_id:ee.get(k.PdpCommentSearch),impression_id:Z.get(k.PdpCommentSearch),query:e,query_id:te.get({query:e,scope:{type:I.PDP,path:this.path}},k.PdpCommentSearch),origin_element:$.CommentSearchBar,origin_page_type:P.PostDetail}}}addSearchParamsToUrl(e){const t=location.href,i=new URL(t);i.searchParams.set(Y.Query,e.query),i.searchParams.set(Y.Pane,w.Comments),i.searchParams.set(Y.ConversationId,e.conversationId??ee.get(k.PdpCommentSearch)),i.searchParams.set(Y.ImpressionId,e.impressionId??Z.getUUID());const s=i.toString();s!==t&&history.replaceState({},"",s)}updated(e){if(e.has("open")){const t=!e.get("open")&&this.open,i=e.get("open")&&!this.open;t?this.focusSearchInput():i&&this.expandSearchButton?.focus()}this.hideElementsVisibility(this.commentSearchActive||this.open)}renderSearchButton(){const e={"aria-controls":"pdp-comment-search-form","aria-expanded":`${this.open}`,id:me,onclick:this.focusSearchInput,type:"button"},t={appearance:"bordered",screenReaderContent:"Développer la recherche de commentaires"};return this.isEntityFilterEnabled?d({attributes:{...e,className:""+(this.open?"hidden":"")},leadingIcon:_({size:L.Small}),size:m.Small,...t}):d({attributes:{...e,className:"border-neutral-border-weak hover:border-neutral-content-weak text-secondary-weak font-normal "+(this.open?"hidden":"")},children:F`<span class="flex pr-xs">${this.searchCommentText()}</span>`,leadingIcon:F`<span class="flex pl-xs">${_({size:L.Small})}</span>`,...t})}render(){return F`<div class="block" data-faceplate-tracking-context="${JSON.stringify(this.searchTelemetryData)}"> <faceplate-tracker source="search" action="click" noun="search_bar"> ${this.renderSearchButton()} </faceplate-tracker> <form class="flex w-full ${S({hidden:!this.open})}" id="pdp-comment-search-form" @submit="${this.handlePdpCommentSearch}"> <faceplate-search-input class="text-secondary-plain m-0 rounded-full outline outline-1 outline-neutral-border-weak flex-grow focus:outline-neutral-content-weak" placeholder="${this.searchCommentText()}" enterkeyhint="search" @keydown="${this.handleKeyDown}" @focus="${()=>{this.open=!0}}" value="${this.initialValue}"> ${d({attributes:{id:"search-input-clear-button",slot:"clearIcon",type:"button",onclick:this.handleClear},appearance:"plain",size:m.Small,screenReaderContent:"Effacer la recherche",leadingIcon:R({size:L.Small})})}</faceplate-search-input> ${d({appearance:"plain",attributes:{className:"ml-xs"+(this.commentSearchActive?" hidden":""),id:"cancel-pdp-comment-search-button",onclick:this.resetSearchInput,type:"button"},children:"Annuler"})} </form> </div>`}};pe.styles=[o],t([i({type:String})],pe.prototype,"target",void 0),t([i({type:String})],pe.prototype,"path",void 0),t([i({attribute:"show-on-load",type:Boolean})],pe.prototype,"showOnLoad",void 0),t([i({type:String,attribute:"initial-value"})],pe.prototype,"initialValue",void 0),t([i({type:Boolean,attribute:"entity-filter-enabled"})],pe.prototype,"isEntityFilterEnabled",void 0),t([u(`#${me}`)],pe.prototype,"expandSearchButton",void 0),t([u("faceplate-search-input")],pe.prototype,"searchInput",void 0),t([g()],pe.prototype,"open",void 0),t([g()],pe.prototype,"commentSearchActive",void 0),pe=t([s("pdp-comment-search-input")],pe);let ue=class extends O{constructor(){super(...arguments),this.commentId="",this.dedupe=!1,this.shouldTrackPosition=!1,this.pubsub=new p(this),this.loadInAd=()=>{const e=this.shouldTrackPosition?this:this.shadowRoot;if(!e||e.childNodes.length>0)return;const t=document.querySelector(`shreddit-comment-tree-ads > template#comment-tree-ad_${this.commentId}`),i=t?.content.querySelector("shreddit-comments-page-ad");t&&i&&this.isNotADuplicate(i)&&(e.replaceChildren(t.content.cloneNode(!0)),i.hasAttribute("is-blank")||this.removeAttribute("class"))},this.isNotADuplicate=e=>{if(!this.dedupe||e.hasAttribute("is-blank"))return!0;const t=document.querySelector("shreddit-comments-page-ad");return!t||e.getAttribute("campaign-id")!==t.getAttribute("campaign-id")}}createRenderRoot(){return this.shouldTrackPosition?this:super.createRenderRoot()}connectedCallback(){super.connectedCallback(),this.commentId&&(this.loadInAd(),this.pubsub.subscribe(r.CommentTreeAdsLoaded,this.loadInAd))}disconnectedCallback(){this.commentId&&this.pubsub.unsubscribe(r.CommentTreeAdsLoaded,this.loadInAd),super.disconnectedCallback()}render(){return V}};ue.styles=[o],t([i({type:String,attribute:"comment-id"})],ue.prototype,"commentId",void 0),t([i({type:Boolean,attribute:"dedupe"})],ue.prototype,"dedupe",void 0),t([i({type:Boolean,attribute:"should-track-position"})],ue.prototype,"shouldTrackPosition",void 0),ue=t([s("shreddit-comment-tree-ad")],ue);let be=class extends O{constructor(){super(...arguments),this.translationContextValue=j,this.isCommentPretranslated=!1,this.pubsub=new p(this),this.onPostTranslationOverride=e=>{(e.id===this.postId||e.isContextUpdateEvent)&&(this.postTranslationOverrideActive=e.isTranslationActive,this.commentTranslationOverrideActive=void 0)},this.onCommentTranslationOverride=e=>{e.id===this.commentId&&(this.commentTranslationOverrideActive=e.isTranslationActive)}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(r.I18nCommentTranslationOverride,this.onCommentTranslationOverride,!1),this.pubsub.subscribe(r.I18nPostTranslationOverride,this.onPostTranslationOverride,!1),this.isMTSEOUserPage=D(),this.globalSetting=this.isCommentPretranslated||this.isMTSEOUserPage}disconnectedCallback(){super.disconnectedCallback(),this.pubsub.unsubscribe(r.I18nCommentTranslationOverride,this.onCommentTranslationOverride),this.pubsub.unsubscribe(r.I18nPostTranslationOverride,this.onPostTranslationOverride)}render(){const e=this.postTranslationOverrideActive,t=this.commentTranslationOverrideActive,i="boolean"==typeof e?"boolean"==typeof t&&t!==e:"boolean"==typeof t&&t!==this.globalSetting,s=!!i&&!t;return i?F`<div class="flex items-center text-neutral-content-weak" data-testid="comment-translation-status-icon"> ${!!i&&t?U({size:L.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-translated-icon","aria-label":"Le commentaire est traduit"}}):V} ${s?N({size:L.ExtraSmall,attributes:{"data-testid":"comment-translation-status-icon-original-icon","aria-label":"Le commentaire est dans la langue d’origine",className:s?"":"hidden"}}):V} </div>`:V}};be.styles=[o],t([E({context:B,subscribe:!0}),g()],be.prototype,"translationContextValue",void 0),t([g()],be.prototype,"commentTranslationOverrideActive",void 0),t([g()],be.prototype,"postTranslationOverrideActive",void 0),t([g()],be.prototype,"isMTSEOUserPage",void 0),t([g()],be.prototype,"globalSetting",void 0),t([i({type:String,attribute:"comment-id"})],be.prototype,"commentId",void 0),t([i({type:String,attribute:"post-id"})],be.prototype,"postId",void 0),t([i({type:Boolean,attribute:"comment-pretranslated"})],be.prototype,"isCommentPretranslated",void 0),be=t([s("comment-translation-status-icon")],be);let ge=class extends O{connectedCallback(){const e=this.getFullUrl();e.includes(":~:text=")?this.goToCommentWithTextFragment(e):this.goToCommentWithId(),super.connectedCallback()}goToCommentWithId(){const e=window.location.hash;if(!e)return;const t=e.substring(1);if(!t)return;const i=`t1_${t}-comment-rtjson-content`,s=document.getElementById(i);if(!s)return;const n=document.querySelector(`shreddit-comment[thingid="t1_${t}"]`);if(!n)return;s.style.fontWeight="900";const r=n.getBoundingClientRect(),o=n.offsetHeight,a=r.top+window.pageYOffset-o/2;a>window.innerHeight&&window.scrollTo({top:a,behavior:"smooth"})}goToCommentWithTextFragment(e){document.fragmentDirective&&this.setWindowHref(e)}getFullUrl(){const e=performance.getEntriesByType("navigation");return e.length>0?e[0].name:window.location.href}setWindowHref(e){window.location.href=e}render(){return F``}};ge=t([s("comment-url-fragment-manager")],ge),"enabled"===window.CLIENT_EXPERIMENTS?.shreddit_pdp_no_mod_js_lo?ie()&&import("./index-logged-in-babf8c8c.js"):import("./index-logged-in-babf8c8c.js");
