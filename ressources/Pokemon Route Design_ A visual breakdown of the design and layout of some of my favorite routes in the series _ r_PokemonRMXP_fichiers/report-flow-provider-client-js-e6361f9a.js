import{_ as t,n as e,I as s,e as o,P as r,m as i,cv as a,q as n,R as l,cw as p,T as c,cx as d,c as u,K as h,G as m}from"./shell-a9dcd804.js";import"./report-flow-client-js-aac0905e.js";import{ao as b}from"./age-gate-standalone-client-js-55e13342.js";import"./community-onboarding-completed-modal-client-js-e3c10ae1.js";import{s as g,x as w}from"./icon-d7ad820f.js";import{g as y,c as C,a as k,b as f}from"./submit-report-helper-a064b6c4.js";import{F as j}from"./types-ba1b15db.js";import"./chat-mobile-xpromo-client-js-342f9966.js";import"./app-selector-client-js-197aee07.js";import"./helpers-8837cd77.js";import"./constants-775ffd1d.js";import"./filterNullish-9ec33a16.js";import"./promote-post-actions-controller-8a499415.js";import"./expandable-section-header-a5b37930.js";import"./faceplate-radio-input-b52ca406.js";import"./faceplate-progress-433a18f1.js";import"./validate-image-9f48337a.js";import"./text-input-1e857ee0.js";import"./shreddit-slotter-c16b4012.js";import"./zendesk-step-helper-a4df236d.js";import"./faceplate-textarea-input-9ac7fafc.js";import"./index-b42a465d.js";import"./index-bba3d6e7.js";import"./hui-user-drawer-client-js-9e94c0bf.js";import"./TinyGesture-89d9957c.js";let R=class extends g{get rplDialogSheet(){return this.querySelector("rpl-dialog-sheet")}get featureRoot(){return document.querySelector("#report-flow-content-modal rpl-modal-card")}constructor(){super(),this.pubsub=new r(this),this._activateFeature=async t=>i(t),this.initReportFlow=async({thingId:t,authorName:e,authorId:s,flowType:o,triggerElement:r,permalink:i,onCloseCallback:c})=>{this.triggerElement=r,this.onCloseCallback=c;const d=t.startsWith("ad_"),u=o===l.UserDetails,h=o===l.Modmail,m=d||u||h;this.isFlexibleReporting&&!m?(await(this.rplDialogSheet?.showModal()),await this._activateFeature({name:a,renderMode:n.Contents,root:this.featureRoot,queryParams:{is_desktop:!!this.isDesktop,thing_id:t,flow_type:o??l.InlineContent,permalink:i??""}})):await this._activateFeature({name:p,routeParams:{thing_id:t,author_name:e||b(),is_desktop:this.isDesktop?"is-desktop":"is-not-desktop",author_id:s,flow_type:o??l.InlineContent},queryParams:{permalink:i??""},renderMode:n.Contents})},this.closeFlexibleReportFlow=async()=>{await(this.rplDialogSheet?.hide()),this.triggerElement&&this.triggerElement.focus()},this.closeReportFlow=async()=>{await(this.reportFlow?.updateComplete),this.triggerElement&&this.triggerElement.focus()},this.hideReportedAd=async()=>{await(this.reportFlow?.updateComplete),this.onCloseCallback?.()},this.addEventListener("report-flow-close",this.closeReportFlow),this.addEventListener("submit-report-modal",this.hideReportedAd)}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(c.ReportFlowInit,this.initReportFlow,!1),this.pubsub.subscribe(c.ReportFlowClose,this.closeFlexibleReportFlow,!1)}disconnectedCallback(){this.pubsub.unsubscribe(c.ReportFlowInit,this.initReportFlow),this.pubsub.unsubscribe(c.ReportFlowClose,this.closeFlexibleReportFlow),super.disconnectedCallback()}render(){return w`<slot></slot>`}};t([e({type:Boolean,attribute:"is-desktop"})],R.prototype,"isDesktop",void 0),t([e({type:Boolean,attribute:"is-flexible"})],R.prototype,"isFlexibleReporting",void 0),t([s("report-flow")],R.prototype,"reportFlow",void 0),R=t([o("report-flow-provider")],R);let v=class extends g{constructor(){super(...arguments),this.pubsub=new r(this),this._activateFeature=async t=>i(t),this.openCTL=async({authorName:t,thingId:e,userDetailType:s})=>{const o=s?{userDetailType:s}:void 0;await this._activateFeature({name:d,renderMode:n.Contents,routeParams:{authorName:t,thingId:e},queryParams:{...o}})}}connectedCallback(){super.connectedCallback(),this.pubsub.subscribe(c.CTLReportInit,this.openCTL,!1)}disconnectedCallback(){this.pubsub.unsubscribe(c.CTLReportInit,this.openCTL),super.disconnectedCallback()}render(){return w`<slot></slot>`}};v=t([o("ctl-reporting-provider")],v);let F=class extends g{constructor(){super(...arguments),this.closeCTLModal=()=>{this.ctlModal?.hide(),this.dispatchEvent(u("report-flow-close"))}}get ctlModal(){return document.querySelector("rpl-dialog#ctl-report-content-modal")}get ctlModalContents(){return document.querySelector("#ctl-report-content-modal rpl-modal-card")}};F=t([o("base-ctl-component")],F);let E=class extends F{constructor(){super(...arguments),this.requestClientGQL=h,this.showThankYou=()=>{const t=u("shreddit-slotter-set-slot-name",{slotName:"thankyou"});this.ctlModalContents?.querySelector("shreddit-slotter")?.dispatchEvent(t)},this.reportRequest=async(t,e)=>{const s=y[t];if(!s)throw new Error("No corresponding gql operation for the item type provided");try{const t=await this.requestClientGQL({operation:s,variables:{input:e}});return C(t)?t:void 0}catch(t){throw new Error("Error calling the gql report operation")}},this.submitCTLReport=async()=>{if(!this.thingId)return;const t=k(this.thingId);try{const e=f(t,this.thingId,{REPORT_REASONS:"SELF_HARM",...this.userDetailType?{USER_DETAILS:this.userDetailType}:{}});if(!await this.reportRequest(t,e))throw new Error;this.showThankYou(),this.dispatchEvent(u("report-tracking",{reportFlow:{flowOptionSelected:j.REDDITCARES_BUTTON}}))}catch(t){this.dispatchEvent(u("faceplate-alert",{level:m.error,cause:"uncategorized",message:"Une erreur est survenue lors de l’envoi du signalement. Attends un peu, puis réessaie."}))}},this.firstUpdated=()=>{const t=this.querySelector("#ctl-yes-button");t?.addEventListener("click",this.submitCTLReport)}}render(){return w`<slot></slot>`}};t([e({type:String,attribute:"author-name"})],E.prototype,"authorName",void 0),t([e({type:String,attribute:"thing-id"})],E.prototype,"thingId",void 0),t([e({type:String,attribute:"user-detail-type"})],E.prototype,"userDetailType",void 0),E=t([o("ctl-step-one")],E);let T=class extends F{constructor(){super(...arguments),this.firstUpdated=()=>{this.okButton?.addEventListener("click",this.closeCTLModal)}}get okButton(){return this.querySelector("#ctl-ok-button")}render(){return w`<slot></slot>`}};T=t([o("ctl-step-two")],T);
