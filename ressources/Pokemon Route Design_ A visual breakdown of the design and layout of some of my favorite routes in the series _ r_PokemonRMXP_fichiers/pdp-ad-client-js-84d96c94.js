import{A as t,bd as e,be as s,gA as i,f0 as r,fO as o,_ as n,n as a,e as d,av as l,P as c,gB as h,aq as p,c as m,gn as u,J as y,T as b,G as g,bN as v,dc as j,gC as k,gD as I,aw as f}from"./shell-a9dcd804.js";import{x as A,G as E,bi as C}from"./icon-d7ad820f.js";import{s as S,a as x}from"./activate-lead-gen-dialog-5b2b39d4.js";import"./click-location-tracker-3430eb18.js";import{g as w,a as L,s as B,b as T}from"./shreddit-dynamic-ad-link-77e5b3bd.js";import"./shop-gallery-data-fetcher-client-js-cd71f78d.js";import{W as U,e as O}from"./with-ad-observer-972950e0.js";import{c as G,I as D}from"./content-action-button-8d093e66.js";import{S as R}from"./partial-feed-post-client-js-695a46ae.js";import{E as _}from"./links-30dbf643.js";import{a6 as P}from"./age-gate-standalone-client-js-55e13342.js";import{h as z}from"./gallery-fe8fc2ba.js";import"./index-e9ae10a6.js";import"./errors-8d0111b7.js";import"./overflow-menu-actions-ec094350.js";import"./distinguished-tags-4752ad65.js";import"./mod-log-takedown-preview-client-js-dd6db8b8.js";import"./article-details-feed-client-js-d6722a9f.js";import"./index-dd5b6d97.js";import"./award-controller-25d0c262.js";import"./awardsTelemetryState-70c8634d.js";import"./header-action-item-chat-client-js-949dafe8.js";import"./tooltip.base-a366add3.js";import"./rpl-popper-cdaac5d5.js";import"./modActions-183d7a2f.js";import"./mod-bulk-actions-9bc5f299.js";import"./awards-395295be.js";import"./rpl-coachmark-abe2db02.js";import"./rpl-coachmark-card-c876a6a2.js";import"./mod-post-list-client-js-7b3a8a37.js";import"./content-tags-40bc141d.js";import"./shreddit-post-share-button-b3d16788.js";import"./expandable-section-header-a5b37930.js";import"./with-share-10c7b8d9.js";import"./promote-post-actions-controller-8a499415.js";import"./index-7436fa38.js";import"./profile-creation-1d60123b.js";import"./select-controller-b7a961d7.js";import"./user-flair-aefa9eac.js";import"./expandable-mod-reports-base-6a5750ae.js";import"./postFlair-9d6c2791.js";import"./promote-post-button-e731a210.js";import"./translation-intervention-modal-677b21bf.js";import"./translations-2dea4523.js";import"./chat-mobile-xpromo-client-js-342f9966.js";import"./app-selector-client-js-197aee07.js";import"./TinyGesture-89d9957c.js";import"./v2-events-dc55f078.js";import"./mod-verdict-fdcc35ce.js";import"./index-4aa37bbb.js";import"./password-recovery-d61e525b.js";import"./qr-code-modal-upsell-client-js-25088b6d.js";import"./comment-client-js-da2a7314.js";import"./comment-link-post-client-js-7fc51f68.js";import"./cbau-81b2f8bd.js";import"./community-club-highlights-client-js-2b06d5e7.js";import"./subreddit-posting-eligibility-c0987c5f.js";const N=[t.BACKGROUND,t.PROMOTED_LABEL,t.CREDIT_BAR_WHITESPACE,t.TITLE,t.TEXT_BODY,t.ACTION_BAR_WHITESPACE];class F{constructor(t){this._currGalleryIndex=0,this.handleGalleryNavEvent=t=>{const{detail:{details:e}}=t,{noun:s,action:i,source:r,post:o}=e;if(o?.id!==this.host.postId||"gallery"!==r||"click"!==i)return;"forward"===s&&this._currGalleryIndex+1<this.host.galleryItems.length&&this._currGalleryIndex++,"backward"===s&&this._currGalleryIndex-1>=0&&this._currGalleryIndex--;const n=this.host.galleryItems[this._currGalleryIndex].outboundUrl;this.host.querySelectorAll("call-to-action-gallery-links").forEach((t=>t.handleGalleryNavEvent(this._currGalleryIndex))),this.host.querySelectorAll("shreddit-dynamic-ad-link").forEach((t=>{N.includes(t.clickLocation)&&(t.postOutboundLink=n,t.galleryIndex=this._currGalleryIndex)}))},(this.host=t).addController(this)}hostConnected(){this.host.galleryItems?.length&&this.host.addEventListener("track-event",this.handleGalleryNavEvent)}hostDisconnected(){this.host.removeEventListener("track-event",this.handleGalleryNavEvent)}}class q{constructor(t){(this.host=t).addController(this)}hostConnected(){this.host.impressionId||this.host.hasAdEvents||(this.hydrateAdEventsFromStorage(),this.hydrateAdUserTargetingFromStorage(),this.host.hasAdEvents&&(this.updateDynamicLinkUrls(),this.updateCallToActionGalleryLinkUrls(),this.host.setupAdObserver()))}updateDynamicLinkUrls(){const t=e(s);this.host.querySelectorAll("shreddit-dynamic-ad-link").forEach((e=>{if(t){const t="/"===e.outboundLinkOverride?.charAt(0),s=!!this.host.galleryItems;if(t||!s&&e.outboundLinkOverride===i)return;return void(e.outboundLinkOverride=this.host.galleryItems?this.host.galleryItems[e.galleryIndex??0]?.outboundUrl:this.host.outboundLinkUrl)}const s="/"===e.postOutboundLink.charAt(0),r=!!this.host.galleryItems;s||!r&&e.postOutboundLink===i||(e.postOutboundLink=this.host.galleryItems&&this.host.galleryItems[e.galleryIndex??0]?.outboundUrl||this.host.outboundLinkUrl)}))}updateCallToActionGalleryLinkUrls(){e(s)||this.host.querySelectorAll("call-to-action-gallery-links").forEach((t=>{if(!this.host.galleryItems)return;const e=this.host.galleryItems.map((t=>t.outboundUrl));t.galleryOutboundLinks=e}))}hydrateAdEventsFromStorage(){const t=new URL(r.href).searchParams.get(o);this.host.impressionId=t||"";const e=w(this.host.impressionId);e&&(this.host.adEvents=e.adEvents,this.host.outboundLinkUrl=e.clickRedirectUrl,this.host.galleryItems&&e.galleryAdData&&(this.host.galleryItems=e.galleryAdData?.map(((t,e)=>({...(this.host.galleryItems||[])[e],adEvents:t.adEvents,outboundUrl:t.clickRedirectUrl})))))}hydrateAdUserTargetingFromStorage(){const t=L();t&&(this.host.adUserTargeting=t)}}const H=U(R);let $=class extends H{constructor(){super(...arguments),this.impressionId="0",this.isBlank=!1,this.isCommentingDisabled=!1,this.isSharingDisabled=!1,this.isSurveyAd=!1,this.placement=l.FEED,this.isPixelFiringRefactorExperimentEnabled=!1,this.AdPostHydrationController=new q(this),this.AdPostGalleryLinksController=new F(this),this.pubSub=new c(this),this._trackAdClick=this._events.define("observe-ad-click",(async e=>{const s=this.postType===h.Image,i=this.postType===h.Video,r=i&&this.viewType!==p.CompactView&&e.detail.clickLocation!==t.MEDIA,o=i&&this.viewType===p.CompactView;(s||o||r)&&(await this._activateLeadGenDialog(),S({leadGenInfo:this.leadGenInfo,postId:this.id,impressionId:this.impressionId,onSuccess:()=>this.dispatchEvent(m(u))}))})),this.onAdUpdateAction=({action:t,impressionId:e})=>{"hide"===t&&e===this.impressionId&&(this.hidden=!0)},this.checkTextBodySize=t=>{t[0].target.clientHeight>0&&(this.hideTextPostContentOverflow(),this.textResizeObserver.disconnect())}}static get styles(){return[...super.styles,y(":host {\n  position: relative;\n}\n.ad-link-bar {\n  grid-column: 1 / 13;\n  height: 40px;\n  border-top: transparent;\n}\n.meta-row {\n  grid-column: 1 / 4;\n}\n.grid-template-col-inherit {\n  grid-template-columns: inherit;\n}\n")]}_activateLeadGenDialog(){return x({leadGenInfo:this.leadGenInfo})}get hasAdEvents(){return this.adEvents?.length>0}handleCarouselArrowClick(t){t.preventDefault();z(this,t,this.impressionId)}connectedCallback(){super.connectedCallback(),this.pubSub.subscribe(b.AdUpdated,this.onAdUpdateAction),this.setupAdObserver();const t=this.querySelector(`#${this.id}-post-rtjson-content`);t&&(this.textResizeObserver=new ResizeObserver(this.checkTextBodySize),this.textResizeObserver.observe(t))}setupAdObserver(){!this.isAdObserved&&this.hasAdEvents&&this.enableAdObserver({postElement:this,events:O(this.adEvents),postId:this.id,impressionId:this.impressionId,adType:this.adType,dimensions:this.dimensions,galleryItems:this.galleryItems?.map((t=>({...t,adEvents:O(t.adEvents||[])})))})}disconnectedCallback(){this.pubSub.unsubscribe(b.AdUpdated,this.onAdUpdateAction),this.textResizeObserver?.disconnect(),super.disconnectedCallback()}handleView(t,e){super.handleView(t,e,this.galleryItems?.length)}handleShareClick(){if(this.isSharingDisabled){const t=m("faceplate-alert",{level:g.notice,message:"Le partage a été désactivé pour cette publication"});this.dispatchEvent(t)}else this.handleShareButtonInteraction()}handleClickCommentsButton(t){if(this.isSurveyAd)super.handleClickCommentsButton(t);else if(this.isCommentingDisabled){const t=m("faceplate-alert",{level:g.notice,message:"Les commentaires ont été désactivés pour cette publication"});this.dispatchEvent(t)}else this.isFeed?(B({impressionId:this.impressionId,adEvents:this.adEvents,clickRedirectUrl:this.outboundLinkUrl,galleryAdData:this.galleryItems?.map((t=>({adEvents:t.adEvents,clickRedirectUrl:t.outboundUrl})))}),T(this.adUserTargeting),this.trackEvent(_(this))):super.handleClickCommentsButton(t)}renderCommentsButton(){if(this.isCommentingDisabled)return A`${G({size:this.defaultActionButtonSize,appearance:P()?"bordered":"secondary",attributes:{type:"button",className:this.defaultActionButtonClassnames,onclick:this.handleClickCommentsButton,name:"comments-action-button","data-post-click-location":v.COMMENTS_BUTTON},leadingIcon:E({attributes:{className:"icon-comment","aria-hidden":"true"},size:D[this.defaultActionButtonSize]}),screenReaderContent:"comments",children:A`<faceplate-number number="${this.commentCount}" pretty></faceplate-number>`})}`;{const t=new URL(this.permalink,window.location.origin);return t.searchParams.set(j,"1"),t.searchParams.set(o,this.impressionId),this.leadGenInfo?.campaignId&&t.searchParams.set(k,this.leadGenInfo.campaignId),this.videoAdLoopingExperiment&&t.searchParams.set(I,this.videoAdLoopingExperiment),this.permalink=t.pathname+t.search,super.renderCommentsButton()}}renderShareButton(){if(this.isSharingDisabled){const t="Partager";return A`${G({size:this.defaultActionButtonSize,appearance:P()?"bordered":"secondary",attributes:{type:"button",onclick:this.handleShareClick,onkeydown:this.handleShareClick,className:this.defaultActionButtonClassnames},leadingIcon:C({attributes:{className:"icon-share","aria-hidden":"true"},size:D[this.defaultActionButtonSize]}),screenReaderContent:t,children:t})}`}return this.shareButtonSSR=!1,super.renderShareButton()}renderHiddenPost(){return A` <div class="hidden-post h-3xl flex items-center justify-between px-md"> <div> <p class="m-0 font-semibold text-neutral-content-strong text-14"> Publicit\u00E9 masqu\u00E9e </p> </div> </div> `}renderActionRow(){return this.isSurveyAd?A``:super.renderActionRow()}render(){return this.hidden?this.renderHiddenPost():A` <shreddit-with-observer-wrapper id="in-feed-ad" .config="${{threshold:f}}"> ${this.isBlank?null:super.render()} </shreddit-with-observer-wrapper>`}};n([a({type:String,attribute:"post-id"})],$.prototype,"postId",void 0),n([a({type:Array,attribute:"ad-events",reflect:!0})],$.prototype,"adEvents",void 0),n([a({type:Array,attribute:"gallery-items",reflect:!0})],$.prototype,"galleryItems",void 0),n([a({type:Object,attribute:!0})],$.prototype,"dimensions",void 0),n([a({type:String,attribute:"ad-type"})],$.prototype,"adType",void 0),n([a({type:String,attribute:"outbound-link-url",reflect:!0})],$.prototype,"outboundLinkUrl",void 0),n([a({type:String,attribute:"impression-id"})],$.prototype,"impressionId",void 0),n([a({type:Object,attribute:"ad-user-targeting",reflect:!0})],$.prototype,"adUserTargeting",void 0),n([a({type:String,attribute:"video-ad-looping-experiment",reflect:!0})],$.prototype,"videoAdLoopingExperiment",void 0),n([a({type:Boolean,attribute:"is-blank"})],$.prototype,"isBlank",void 0),n([a({type:Boolean,attribute:"is-commenting-disabled"})],$.prototype,"isCommentingDisabled",void 0),n([a({type:Boolean,attribute:"is-sharing-disabled"})],$.prototype,"isSharingDisabled",void 0),n([a({type:Boolean,attribute:"is-survey-ad"})],$.prototype,"isSurveyAd",void 0),n([a({type:String,attribute:"country-code"})],$.prototype,"countryCode",void 0),n([a({type:String,attribute:"placement"})],$.prototype,"placement",void 0),n([a({type:Object,attribute:"lead-gen-info"})],$.prototype,"leadGenInfo",void 0),n([a({type:String,attribute:"campaign-id"})],$.prototype,"campaignId",void 0),n([a({type:String,attribute:"encrypted-tracking-payload"})],$.prototype,"encryptedTrackingPayload",void 0),n([a({type:Array,attribute:"additional-event-metadata"})],$.prototype,"additionalEventMetadata",void 0),n([a({type:Boolean,attribute:"pixel-firing-refactor-experiment-enabled"})],$.prototype,"isPixelFiringRefactorExperimentEnabled",void 0),n([a({type:String,attribute:"ads-correlation-id"})],$.prototype,"adsCorrelationId",void 0),$=n([d("shreddit-ad-post")],$);
